services:

  # ── LoomPipe application ───────────────────────────────────────────────────
  loompipe:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "${APP_PORT:-8080}:8080"
    environment:
      ASPNETCORE_ENVIRONMENT: Production
      # Production appsettings selects Sqlite with /app/data/loompipe.db
      Jwt__SecretKey: "${JWT_SECRET_KEY:-CHANGE_ME_IN_PRODUCTION_USE_A_LONG_RANDOM_64_CHAR_KEY!!}"
      Jwt__Issuer: "LoomPipe"
      Jwt__Audience: "LoomPipeClient"
      Jwt__ExpiryHours: "8"
      DataProtection__KeysPath: /app/keys
    volumes:
      - appdata:/app/data
      - dpkeys:/app/keys
    restart: unless-stopped

volumes:
  appdata:
  dpkeys:
